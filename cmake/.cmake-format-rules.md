# CMake Formatting Rules for Atlas Project

**IMPORTANT: These rules must be applied deterministically and consistently. No random variations.**

## General Principles

1. **Readability over compactness** - Prefer vertical layouts for complex commands
2. **Keywords on their own line** - PUBLIC, PRIVATE, INTERFACE, etc. go on separate lines
3. **Simple statements stay compact** - Don't over-split simple commands

## Indentation

- Use **4 spaces** for base indentation
- Multi-line command arguments: indent **4 spaces** from command start (1 additional level)
- Keywords (PUBLIC, PRIVATE, etc.): indent **4 spaces** from command start
- Arguments under keywords: indent **4 spaces** from keyword (= **8 spaces** from command start)

## Specific Rules

### 1. IF/ENDIF Statements

**Simple conditions (< 100 chars): Keep on one line**
```cmake
if(NOT CMAKE_BUILD_TYPE AND NOT CMAKE_CONFIGURATION_TYPES)
    # body
endif()
```

**Complex conditions: Break logically, align continuation**
```cmake
if(LONG_CONDITION_PART_ONE
   AND ANOTHER_CONDITION
   OR (COMPLEX AND NESTED))
    # body
endif()
```

### 2. project() Command

```cmake
project(Atlas
        VERSION 1.0.0
        LANGUAGES CXX)
```

### 3. target_sources()

**Keywords (PUBLIC, PRIVATE, INTERFACE) on their own line, files indented below:**
```cmake
target_sources(my_target
    PRIVATE
        file1.cpp
        file2.cpp
        file3.cpp

    PUBLIC
        header1.hpp
        header2.hpp)
```

### 4. target_link_libraries()

**Keywords on their own line, libraries indented below:**
```cmake
target_link_libraries(my_target
    PUBLIC
        Boost::json
        SomeLib::SomeLib

    PRIVATE
        InternalLib)
```

**Simple case (fits on one line):**
```cmake
target_link_libraries(my_target PRIVATE simple_lib)
```

### 5. target_include_directories()

**Keywords on their own line, paths indented below:**
```cmake
target_include_directories(my_target
    PUBLIC
        "${PROJECT_SOURCE_DIR}/include"
        "${CMAKE_BINARY_DIR}/generated"

    PRIVATE
        "${CMAKE_CURRENT_SOURCE_DIR}/detail")
```

**With generator expressions - each on its own line:**
```cmake
target_include_directories(atlas_lib
    PUBLIC
        $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/src/lib>
        $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/atlas>)
```

### 6. add_library() / add_executable()

**Multiple sources: vertical layout**
```cmake
add_library(my_lib
    src1.cpp
    src2.cpp
    src3.cpp)
```

**Single source or simple:**
```cmake
add_executable(my_exe main.cpp)
```

### 7. install()

**Keywords on their own line:**
```cmake
install(TARGETS my_target
    EXPORT MyTargets
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR})
```

```cmake
install(FILES file1.txt file2.txt
    DESTINATION ${CMAKE_INSTALL_DATADIR})
```

### 8. FetchContent_Declare()

**Each parameter on its own line:**
```cmake
fetchcontent_declare(Boost
    URL https://github.com/boostorg/boost/releases/download/boost-1.85.0/boost-1.85.0-cmake.tar.gz
    URL_HASH SHA256=ab9c9c4797384b0949dd676cf86b4f99553f8c148d767485aaac412af25183e6
    SYSTEM
    DOWNLOAD_EXTRACT_TIMESTAMP ON)
```

### 9. set() Command

**Simple:**
```cmake
set(MY_VAR value)
```

**With options:**
```cmake
set(CMAKE_BUILD_TYPE "Release"
    CACHE STRING "Choose the type of build."
    FORCE)
```

**Multiple values on one line if they fit:**
```cmake
set(BOOST_INCLUDE_LIBRARIES json describe uuid headers)
```

### 10. option() Command

**Keep on one line if it fits (<100 chars):**
```cmake
option(BUILD_TESTS "Build test suite" ON)
```

### 11. find_package()

**Simple:**
```cmake
find_package(Threads REQUIRED)
```

**With components:**
```cmake
find_package(Boost
    REQUIRED
    COMPONENTS json)
```

### 12. Custom Functions (add_atlas_strong_type, etc.)

**Each parameter on its own line with keyword-style formatting:**
```cmake
add_atlas_strong_type(
    NAME UserId
    TYPE int
    DESCRIPTION "==, !=, <=>"
    NAMESPACE example
    TARGET my_types)
```

## Case Conventions

- **Commands**: lowercase (cmake_minimum_required, add_library, target_link_libraries)
- **Keywords**: UPPERCASE (PUBLIC, PRIVATE, INTERFACE, REQUIRED, COMPONENTS)
- **Variables**: Follow CMake convention (CMAKE_BUILD_TYPE, PROJECT_SOURCE_DIR)

## Spacing and Blank Lines

- One blank line between major sections
- No blank lines within a command's arguments (except for visual grouping in target_sources)
- Blank line before and after comments

## Comments

- `##` for file headers
- `#` for inline/section comments
- Keep comments on their own line when possible

## Closing Parentheses

- Align with the opening command name
- No extra indentation

## Examples of What NOT to Do

**❌ Aligned continuation (looks ugly):**
```cmake
target_include_directories(atlas_lib PUBLIC $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/src/lib>
                                            $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}/atlas>)
```

**❌ Over-split simple IF:**
```cmake
if(NOT
   CMAKE_BUILD_TYPE
   AND NOT
       CMAKE_CONFIGURATION_TYPES)
```

**❌ Keywords on same line as first argument:**
```cmake
target_link_libraries(my_target PRIVATE Boost::json
                                        SomeLib)
```

**❌ Wrong indentation (too much):**
```cmake
set(CMAKE_BUILD_TYPE "Release"
        CACHE STRING "Choose the type of build."
        FORCE)
```

**❌ Keywords not standing out:**
```cmake
target_link_libraries(atlas_lib
    PRIVATE Boost::describe
            Boost::json)
```

## Temperature Setting

**CRITICAL: When applying these rules, use deterministic formatting:**
- No creative interpretation
- No random variations
- Apply rules mechanically and consistently
- If a pattern matches a rule, apply that rule exactly
- If uncertain, prefer vertical layout with keywords on separate lines
